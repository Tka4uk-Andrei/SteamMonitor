# SteamMonitor

## Содержание
- [Краткое описание](#краткое-описание)
- [Используемые билиотеки](#используемые-билиотеки)
- [Статус проекта](#cтатус-проекта)
- [Инструкция по работе и настройке](#инструкция-по-работе-и-настройке)
- [История проекта](#история-проекта)

## Краткое описание
Программа используется для сопоставления цен на торговой площадке steam и вторичном рынке обмена (tf2mart),
с целью поиска выгодных предложений. В будущем планировался анализ множества площадок.

## Используемые билиотеки
- [HtmlAgilityPack](https://www.nuget.org/packages/HtmlAgilityPack/) - NuGet библиотека, используется для парсинга html страниц.
- Проект собирается в VS Studio 2017
- Версия .NET 4.5.2

## Статус проекта
На текущий момент проект находится в практически замороженном состоянии, так как использование 
программы практически не рентабельно. Также происходит рефакторинг кода в некоторых местах, 
а также упрощается взаимодействие с программой.

## Инструкция по работе и настройке
Перед запуском программы требуется задать значения cookies в cookies.json для: 
 - [steam](https://steamcommunity.com/)
 - [tf2Mart](https://tf2mart.net/)
 
Значения задаются в формате json. Пример приведён ниже.

```json

{
  "steam_market": [
      {
        "domain": "domain_str",
        "expirationDate": 0,
        "hostOnly": false,
        "httpOnly": false,
        "name": "name_str",
        "path": "path_str",
        "sameSite": "sameSite_str",
        "secure": false,
        "session": false,
        "storeId": "storeId_str",
        "value": "value_str",
        "id": 1
      }
  ],
  "tf2mart": [
    {
        "domain": "domain_str",
        "expirationDate": 0,
        "hostOnly": false,
        "httpOnly": false,
        "name": "name_str",
        "path": "path_str",
        "sameSite": "sameSite_str",
        "secure": false,
        "session": false,
        "storeId": "storeId_str",
        "value": "value_str",
        "id": 1
    }
  ]
}

```

Также для работы надо задать цены ключей в steamKey.dat и tf2MartKey.dat.
На двух строках находятся цены для покупки и продажи.

После установки параметров в файлах, программу можно запустить. На экране несколько 
кнопок, после нажатия на которые происходит загрузка данных и анализ, того что выгодно 
купить на tf2Mart, затем появляется список с выгодными предложениями. По каждому 
предложению можно просмотреть количество проданных предмтеов за последние 24 часа.

Итоговая список выглядит как таблица и состоит из следующих столбцов:
- Название товара 
- Цена покупки (*в величинах площадки для покупки*)
- Прибыль с одной продажи (*в величинах площадки для продажи*)
- Кнопка для просмотра количества проданных предметов
- Количество проданных предметов (*отображается, если была нажата кнопка*)
- Цветовой индикатор, показывающий наличие товара в заявках на продажу (*оранжевый, если заявка есть*)

## История проекта
Здесь находится описание истории всего проекта и идеии. Данную секцию можно воспринимать 
в какой-то степени как мемуары (?) проекта.

Причиной для рассмотрения торговли в TF2 стало нахождение выгодной схемы купли-продажи 
ограниченного числа предметов одноклассником. Я же решил расширить данную идею, а именно
автоматизировать рассчёты и поиск выгодных предложений, так как ручной обсчёт более 100
предметов в ручную занимает довольно много времени. 

По факту идея данной программы зародилась, когда автор закончил 8й класс. 

Первая реализация представляла из себя программу которая по введённым ценам, 
говорила выгодна сделка или нет. Потом была сделана доработка: цены с названиями 
из steam собирались с помощью макроса с записанными движениями мышки.

Следующим этапом стало создание простейшего парсера html на языке паскаль. Html код загружался 
посредством сторонних программ: сначала с помощью автокликера, затем использовалась программа 
для загрузки html страниц (для неё отдельной прогой формировался список url для загрузки). 

Третьим шагом стал переход к написанию программы на C/C++. Таким обрзом хотелось изучить
новый язык, а также автоматизировать процесс загрузки страниц, также причиной было то, что
программа, загружающая html код, перестала выполнять возложенные обязаности. В итоге, хоть 
программа всё ещё выполнялась в консоли, но функционалу она стала близка текущей итерации.
По заданым валютным ценам и cookie она самостоятельно загружала web страницы и парсила их,
а после уже анализировала и выдавала список с выгодными сделками.

На четвёртой итерации проект в очередной раз решил переехать на другой язык программирования - C#.
Причина заключалась в изучении ОПП языка, удобстве использования классов для взаимодействия с WEB,
а также решение реализовать программу с красивым интерфейсом WPF. Также стоит отметить, что WPF
использует более удобную для реализации архитектуру, нежели winForms.

После для программы был написан помошник, который помогал удобно снимать и выставлять предметы на
торговой площадке.

Дальнейшее развитие программы заключалось в попытках построить, как на тот момент казалось, _супер-пупер 
крутую и масштабируемую архитектуру_. Все попытки были провалены, как и идеи попытаться расширить список 
торговых площадок для анализа предложений.

На момент середины августа 2020 года, работа программы была восстановлена, происходит вялотекущий процесс
рефакторинга, документирования и доработки функционала. Причиной такого темпа является то, что не понятно
насколько оправдана доработка и использование программы, так как активность на рынке Team Fortress 2 довольно
слабая.

> Изложение общей истории развития на этом можно закончить, так как дальнейшая история будет сконцентрирована
> на описании как успешно данные программы использовались.

В начале особого интузиазма и мыслей, что программа будет приносить золотые горы не было, существовала лишь 
цель проверки существования других сделок. (_Тут я точно не помню, но вроде как на первых порах написания проги
мне помогал одноклассник Л, он давал советы как можно генерировать и получать цены на предметы в steam. Это касается
только первых двух итераций проекта_) После первых запусков стало видно, что цены steam market и цены для обменов
разняться часто и довольно сильно (> 10% разницы). Мало того спрос на товары в steam market был очень велик! Возможно
в этом крылся такой большой дисбаланс.

В общем, после первых прогонов, проверок и отладок началась активная торговля. Предметы продавались очень быстро. 
Особенно стоит отметить торговлю _призрачными душами_ первое время они составляли значительную часть сделок, так 
как торговля ими стабильно приносила прибыль, а запуск программы был достаточно трудоёмким процессом. Также первое 
время можно было гибко варьировать объёмы продаж, докупая валюту сразу, не ожидая 7 дней, когда будет разрешён обмен.
Также это давало возможность реализовать анализ совершения обратных сделок, т.е. покупать в steam, продаваьть в tf2Mart.

В дальнейшем торговля велась относительно постоянно, перерывы были лишь в моменты когда программу хотелось доработать
или переписать её на другой язык, также перерывы были в те моменты когда способы получения информации давали сбои, 
тогда приходилось модифицировать код и искать проблему. Также было замечено, пики активности пользовательей приходятся
на хэллоуин и рождество.

В общем торговля успешно шла, на прибыль покупалсь игры, так продолжалось года два-три потом было решено найти способы
для вывода денег с кошелька steam. Итогом стала продажа ключей сначала платформе, потом торговцу (в последствии он 
написал бота для торговли). В результате за всё время суммарно была выведено меньше 20k. Заметим, что продажа за настоящие 
деньги предполагала продажу с большой уценкой. Так ключ продавался в районе 100 рублей при цене в steam 150-160, что 
было довольно неплохим курсом, если сравнивать с другими ценами на площадках. Да, помимо торговцев существуют сайты-биржи, 
которые сводят покупателей и продавцов. Проблема заключается в том, что спрос на предметы неоднороден, плюс механизм 
продажи достаточно неудобный. Нюанс заключается в том, что в момент сделки нужно присутствовать онлайн. Поэтому идея
с поисками выгодных сделок по продаже была отменена.

В итоге активная торговля была прекращена в середине первого полугодия 11-го класса, потом  ЕГЭ, увы :(.

После поступления планировалось провести рефактринг программы, сделать крутую _архитектуру_. К сожалению, план 
провалился, но чуть-чуть поторговать удалось. Также было замечено снижение торговой активности. Причиной могло
стать введение в steam заявок на покупку. Дальше были периодические попытки рефакторинга и добавления 
авторизации, последнее должно было упростить предварительную насстройку программы, но завершить успешно это 
не удалось. 

Последняя попытка предпринята в середине августа 2020 года. В результате удалось восстановить программу, но 
торговать по старому не удаётся: очень маленький спрос в steam market, а также мало предметов в tf2mart. 
Поэтому было принято решение просто оптимизировать кодовую базу и взаимодействие. 
